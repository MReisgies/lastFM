<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top Songs</title>
  <link rel="stylesheet" href="style.css">
  <!-- Github Button laden von https://buttons.github.io/ -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

<body>
    <div class="header">
        <h1>Top Songs</h1>
    </div>
    <div class="header">
        <p>Simple search for the top songs of artists wihtin the Last.fm online music database.</p> 
          <p>Powered by <a href="https://www.last.fm/api/"style="color:red">Last.fm API</a></p>
          <!-- Github Repo Button -->
          <a class="github-button" href="https://github.com/mreisgies/lastFM/fork" 
          data-color-scheme="no-preference: dark; light: light; dark: dark;" 
          data-size="large" data-show-count="true" 
          aria-label="Fork mreisgies/lastFM on GitHub">Fork</a>
    </div>
    <div>
      <!-- Hier wir die Suchmaske eingesetzt -->
        <form class="searchForm">
          <input type="search" placeholder="Search for an artist" class="searchForm-input">
          <button type="submit" class="icon searchIcon">
              <img src="/assets/note.svg" alt="Music note">
            </button>
    </form>
    </div>
  <!-- Diese Klasse in nÃ¶tig, damit die Suchresultate angezeigt werden -->
  <section class="searchResults">
  </section>
<!-- Hier wird auf JavaScript verwiesen -->
<script>

var global_json_data;
var header = document.querySelector('header');
var section = document.querySelector('section');
let artist = null;

function getSongs() {
  console.log(artist)
  const api_key = '36bd5dad9f52be6a14c9545c4541fda1';
  var request = new XMLHttpRequest();
  request.open('GET',
    `http://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist=${artist}&api_key=${api_key}&format=json`
  );
  request.responseType = 'json';
  request.send();
  request.onload = function () {
    var topSongs = request.response;
    showSongs(topSongs);
  }
}

function showSongs(jsonObj) {
  var songs = jsonObj.toptracks.track;

  const searchResults = document.querySelector('.searchResults');
  searchResults.innerHTML = '';

  for (var i = 0; i < songs.length; i++) {
    console.log(songs[i]);
    var mySong = document.createElement('div');
    var mySongLink = document.createElement('a');
    var myH2 = document.createElement('h2');
    var myListeners = document.createElement('p');
    var myPlays = document.createElement('p');
    var myURL = document.createElement('p');

    mySong.classList.add('song');
    myH2.textContent = songs[i].name;
    mySongLink.href = songs[i].url;
    myListeners.textContent = 'Listeners: ' + songs[i].listeners;
    myPlays.textContent = 'Play Count: ' + songs[i].playcount;
    myURL.textContent = 'lastFM: ' + songs[i].url; 
    

    mySongLink.appendChild(myH2);
    mySongLink.appendChild(myListeners);
    mySongLink.appendChild(myPlays);
    mySongLink.appendChild(myURL);
    mySong.appendChild(mySongLink);
    section.appendChild(mySong);
  }
}

function handleSubmit(event) {
  event.preventDefault();
  const input = document.querySelector('.searchForm-input').value;
  artist = input.trim();
  getSongs()
}

const form = document.querySelector('.searchForm');
form.addEventListener('submit', handleSubmit);


</script>

</body>

</html>